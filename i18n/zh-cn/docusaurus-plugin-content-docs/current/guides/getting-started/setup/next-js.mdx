---
description: 使用 Next.js 作为前端构建工具创建一个 Tauri 应用
pagination_next: guides/development/development-cycle
sidebar_position: 2
sidebar_custom_props:
  doc_card_image: /img/guides/getting-started/setup/nextjs-light.svg
  doc_card_image_dark: /img/guides/getting-started/setup/nextjs-dark.svg
---

import TauriInit from './_fragments/_tauri-init.mdx'
import Commands from './_fragments/_commands.mdx'
import Intro from './_fragments/_intro.mdx'
import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'
import Command, { InstallTauriApi } from '@theme/Command'

# Next.js

本指南将引导您使用 React 框架 [Next.js][] 创建您的第一款 Tauri 应用程序。

<Intro />

这是我们将要构建的内容的预览：

![应用预览](/img/guides/getting-started/setup/next-js/next-js-light.png#gh-light-mode-only) ![应用预览](/img/guides/getting-started/setup/next-js/next-js-dark.png#gh-dark-mode-only)

## 创建前端

[Next.js][] 是一款支持服务端渲染 (SSR) 和静态网站生成 (SSG) 的 React 框架。 由于 Tauri 仅能接受 Next.js 所生成的静态文件，我们将使用 Next.js 的静态网站生成模式。

Next.js 提供了一个类似于 [`create-tauri-app`][] 的脚手架工具，可以从许多预配置的模板中快速创建新项目。
在这个指南中，我们会使用所有问题中推荐的默认值，包括 TypeScript 支持和新近在 v13.4 中稳定化的 `App Router` 特性。
如果您想要使用以前的 `routes/` 目录或者在 `app/` 目录的上层，您仍然需要参考 [Next.js Static Exports](#nextjs-static-exports) 章节中提及并解释的配置进行修改，同时您使用 Tauri 的特殊 JS API 时会与下文存在一定的区别。

<Tabs groupId="package-manager">
  <TabItem value="npm">

```shell
npx create-next-app@latest --use-npm
```

  </TabItem>
  <TabItem value="Yarn">

```shell
yarn create next-app --use-yarn
```

  </TabItem>
  <TabItem value="pnpm">

```shell
pnpm create next-app --use-pnpm
```

  </TabItem>
</Tabs>

1. _项目名称_  
   这将是您项目的名称。它对应该工具将创建的文件夹的名称，但对您的应用程序没有任何影响。您可以在此处填写任何您想要的名称。

## Next.js 静态导出

因为 Tauri 没有一个 Node.js 运行时，因此您必须将 Next.js 设置为 SSG/SPA 模式。
这通常会让页面加载更快，但也需要注意一些注意事项，因此我们建议仔细阅读 Next.js 官方文档中关于[Static Exports][]的部分。

这些文档还显示了 Tauri + Next.js 应用程序所必须的一项配置更改。
为了更改这一配置，请修改项目根文件夹中的 `next.config.js` 文件，并添加如下内容：

```js title=next.config.js
/** @type {import('next').NextConfig} */
const nextConfig = {
  output: 'export',
}

module.exports = nextConfig
```

这会改变 `next build` 命令的行为，使之生成一个 `out/` 文件夹以容纳您的应用程序的 HTML/CSS/JS 资产，而不是将它们写入一个针对于 Next.js 的运行时的 `.next/` 文件夹。

除此之外还有一些可选的配置选项，所以请确保您已经阅读了上文提及的 [Static Exports][] 文档，并根据您项目的需要予以更改。

## 创建 Rust 项目

<TauriInit
  destDirExplination={{ __html: '使用 <code>../out</code> 作为这一项的值' }}
  devPathExplination={{
    __html: '使用 <code>http://localhost:3000</code> 作为这一项的值',
  }}
  beforeBuildCommandExplination={{
    __html:
      '使用 <code>npm run build</code> 作为这一项的值（如果您选择自己的包管理器，请确保已经对此作出调整）。',
  }}
  beforeDevCommandExplination={{
    __html:
      '使用 <code>npm run dev</code> 作为这一项的值（如果您选择自己的包管理器，请确保已经对此作出调整）。',
  }}
/>

现在我们的前端已经构建完成，Rust 项目也已初始化完毕。您马上就可以运行您的应用了！ 您的 `tauri.conf.json` 文件看起来像这样：

```json title=src-tauri/tauri.conf.json
{
  "build": {
    "beforeBuildCommand": "npm run build",
    "beforeDevCommand": "npm run dev",
    "devPath": "http://localhost:3000",
    "distDir": "../out"
  },
  ...
}
```

就是这样！ 现在您可以在您的终端中运行接下来的命令来开始您的应用程序的开发构建：

<Command name="dev" />

![应用窗口](/img/guides/getting-started/setup/next-js/next-js-dev-light.png#gh-light-mode-only) ![应用窗口](/img/guides/getting-started/setup/next-js/next-js-dev-dark.png#gh-dark-mode-only)

## 调用指令

<Commands />

使用 [`@tauri-apps/api`][] JavaScript 库来调用新创建的命令， 通过 JavaScript 访问诸如窗口、文件系统等核心功能， 您可以使用自己喜欢的 JavaScript 包管理器来安装。

<InstallTauriApi />

一个需要提及的重点是，所有 Tauri 的 JS API 都需要访问仅限浏览器的 API，意味着它们只能被用于 [用户端组件][Client Components]。
如果您不需要服务端组件，您可以在 `app.page.tsx` 文件的最开始添加 `'use client'`，而在这个指南中，我们会创建一个独立的组件，因此我们不需要转换整个应用程序。

```tsx title=app/greet.tsx
'use client'

import { useEffect } from 'react'
import { invoke } from '@tauri-apps/api/tauri'

export default function Greet() {
  useEffect(() => {
    invoke<string>('greet', { name: 'Next.js' })
      .then(console.log)
      .catch(console.error)
  }, [])

  // 必须。因为我们以后会使用Greet作为一个组件。
  return <></>
}
```
现在，我们将在 `app/page.tsx` 中的默认 `Home` 组件中使用此组件。
请注意，它必须在实际的组件树中且不能是简单的函数调用，只要父组件（在本例中为 `Home` ）是服务器组件即可。

```tsx title=app/page.tsx
// ...
import Greet from './greet'

export default function Home() {
  return (
    <main className="flex min-h-screen flex-col items-center justify-between p-24">
      // highlight-next-line
      <Greet />
      ...
    </main>
  )
}
```

:::tip

若您想要了解更多有关 Rust 和 JavaScript 之间通信的信息，请参阅 Tauri [进程间通信][inter-process-communication]指南。

:::

<!-- TODO: Show how you can add this and screenshots of what it looks like -->

[Next.js]: https://nextjs.org
[`@tauri-apps/api`]: ../../../api/js/
[inter-process-communication]: ../../../references/architecture/inter-process-communication/readme.md
[`create-tauri-app`]: https://github.com/tauri-apps/create-tauri-app
[Static Exports]: https://nextjs.org/docs/app/building-your-application/deploying/static-exports
[Client Components]: https://nextjs.org/docs/getting-started/react-essentials#client-components
