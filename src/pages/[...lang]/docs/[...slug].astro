---
import Layout from "@src/layouts/SidebarLayout.astro";
import { filterFragments } from "@src/utils";
import { getCollection } from "astro:content";
import { buildLocalizedCollection } from "@src/i18n";

export async function getStaticPaths() {
  let collection = await getCollection("docs");
  let filteredCollection = filterFragments(collection);
  let localizedCollection = buildLocalizedCollection(filteredCollection);
  const paths = localizedCollection.map((entry) => {
    return {
      params: {
        lang: entry.lang,
        slug: entry.slug === "" ? undefined : entry.slug,
      },
      props: {
        entry,
        collection: localizedCollection,
      },
    };
  });
  return paths.flat();
}

const { entry, collection } = Astro.props;
const { Content, headings } = await entry.render();

// This removes the root index item from the sidebar
const filteredCollection = collection.filter(
  (entry: { slug: string }) => entry.slug !== ""
);
---

<Layout
  title={entry.data.title}
  sidebarEntries={filteredCollection}
  headings={headings}
>
  <div class="prose">
    <Content />
  </div>
</Layout>
