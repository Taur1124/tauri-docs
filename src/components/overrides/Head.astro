---
import type { Props } from '@astrojs/starlight/props';
import Default from '@astrojs/starlight/components/Head.astro';
import {imageURL} from '../../assets/dynamic-og/utils'

// Handle edge cases and custom images
const customImage: Record<string, string> = {
	// homepage
	'/': '/og.png',
	// blog main pages
	'/blog': '/og.png',
	'/blog/2': '/og.png',
	'/blog/3': '/og.png',
};

function getSocialImage(): URL | null {
	let path = Astro.url.pathname.replace(/\/$/, '');

	if (path.endsWith('.png')) {
		return null;
	}

	if (customImage[path]) {
		return new URL(customImage[path], Astro.url);
	} else {
		let imagePath = imageURL[path] || path;
		// TODO: Improve cache busting
		return new URL(`/social-images/content/docs${imagePath}.png?v=1`, Astro.url);
	}
}
const socialImage = getSocialImage();
---

<!-- /* TODO: - Check if is possible dynamic generate on astro.config head without overriding Head.astro - No specific reason
              - Make sure the URL pattern matches every page and if default fallback is working.
-->
<Default {...Astro.props} />
{
	socialImage && (
		<>
			<meta name="twitter:image" content={socialImage} />
			<meta property="og:image" content={socialImage} />
		</>
	)
}
